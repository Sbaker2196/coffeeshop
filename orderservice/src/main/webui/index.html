<!doctype html>

<head>
  <link rel="stylesheet" type="text/css" href="quinoa.css" />
</head>
<div class="hero-image">
  <div class="logo">
    <img src="coffeeshop-logo.png" />
  </div>
  <div class="hero-text">
    <h1>Sean's Coffee Shop</h1>
    <p id="subheading">Fullstack Quarkus Microservice Web Application</p>
  </div>
  <div class="container">
    <div class="topnav">
      <a class="active" href="https://github.com/Sbaker2196/coffeeshop/tree/master" target="_blank">GitHub
      </a>
      <a href="#howitworks" target="_blank">How it works</a>
      <a href="#contact" target="_blank">Documentation</a>
      <a href="#about" target="_blank">Observability</a>
    </div>
  </div>
</div>

<body class="body">
  <div class="menu">
    <div style="text-align: center">
      <h2>Menu</h2>
    </div>
  </div>
  <div class="tableContainer">
    <div class="tableLeft">
      <div>
        <table>
          <tr>
            <td>Espresso</td>
            <td>2,50</td>
            <td>
              <button onclick="buyEspresso()" id="espressoButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Americano</td>
            <td>3,00</td>
            <td>
              <button onclick="buyAmericano()" id="americanoButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Cappuccino</td>
            <td>3,50</td>
            <td>
              <button onclick="buyCappuccino()" id="cappuccinoButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Latte</td>
            <td>3,50</td>
            <td>
              <button onclick="buyLatte()" id="latteButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Latte Macchiato</td>
            <td>4,00</td>
            <td>
              <button onclick="buyLatteMacchiato()" id="latteMacchiatoButton" class="button">
                Buy
              </button>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="tableRight">
      <div>
        <table>
          <tr>
            <td>Bagel</td>
            <td>2,50</td>
            <td>
              <button onclick="buyBagel()" id="bagelButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Croissant</td>
            <td>2,00</td>
            <td>
              <button onclick="buyCroissant()" id="croissantButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Sandwich</td>
            <td>6,50</td>
            <td>
              <button onclick="buySandwich()" id="sandwichButton" class="button">
                Buy
              </button>
            </td>
          </tr>
          <tr>
            <td>Cheesecake</td>
            <td>5,00</td>
            <td>
              <button onclick="buyCheeseCake()" id="cheeseCakeButton" class="button">
                Buy
              </button>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div id="result" class="result">
    <div class="textContainer">
      <textarea id="eventTextArea" rows="20" cols="80" readonly></textarea>
    </div>
    <script>
      var source = new EventSource(
        "http://localhost:8081/product-service/recipes",
      );
      source.addEventListener("message", function (event) {
        var eventData = event.data;
        var resultDiv = document.getElementById("eventTextArea");
        resultDiv.innerHTML += eventData + "\n";
      });
    </script>
  </div>
  <script>
    //Opentelemetry Setup and registration
    const process = require("process");
    const opentelemetry = require("@opentelemetry/sdk-node");
    const { getNodeAutoInstrumentations } = require("@opentelemetry/auto-instrumentations-node");
    const { ConsoleSpanExporter } = require("@opentelemetry/sdk-trace-base");
    const { Resource } = require("@opentelemetry/resources");
    const { SemanticResourceAttributes } = require("@opentelemetry/semantic-conventions");

    const traceExporter = new ConsoleSpanExporter();
    const sdk = new opentelemetry.NodeSDK({
      resource: new Resource({
        [SemanticResourceAttributes.SERVICE_NAME]: "coffeeshop-frontend",
      }),
      traceExporter,
      instrumentation: [getNodeAutoInstrumentations()]
    });

    sdk.start();

    const espressoButton = document.getElementById("espressoButton");
    const americanoButton = document.getElementById("americanoButton");
    const cappuccinoButton = document.getElementById("cappuccinoButton");
    const latteButton = document.getElementById("latteButton");
    const latteMacchiatoButton = document.getElementById(
      "latteMacchiatoButton",
    );
    /*=============================================================================*/
    espressoButton.addEventListener("click", buyEspresso);
    americanoButton.addEventListener("click", buyAmericano);
    cappuccinoButton.addEventListener("click", buyCappuccino);
    latteButton.addEventListener("click", buyLatte);
    latteMacchiatoButton.addEventListener("click", buyLatteMacchiato);
    /*=============================================================================*/
    const bagelButton = document.getElementById("bagelButton");
    const croissantButton = document.getElementById("croissantButton");
    const sandwichButton = document.getElementById("sandwichButton");
    const cheeseCakeButton = document.getElementById("cheeseCakeButton");
    /*=============================================================================*/
    bagelButton.addEventListener("click", buyBagel);
    croissantButton.addEventListener("click", buyCroissant);
    sandwichButton.addEventListener("click", buySandwich);
    cheeseCakeButton.addEventListener("click", buyCheeseCake);

    function buyEspresso() {
      let order = {
        name: "espresso",
        price: "2.50",
      };
      sendOrder(order);
    }

    function buyAmericano() {
      let order = {
        name: "americano",
        price: "3.00",
      };
      sendOrder(order);
    }

    function buyCappuccino() {
      let order = {
        name: "cappuccino",
        price: "3.50",
      };
      sendOrder(order);
    }

    function buyLatte() {
      let order = {
        name: "latte",
        price: "3.50",
      };
      sendOrder(order);
    }

    function buyLatteMacchiato() {
      let order = {
        name: "latte macchiato",
        price: "4.00",
      };
      sendOrder(order);
    }

    function buyBagel() {
      let order = {
        name: "bagel",
        price: "2.50",
      };
      sendOrder(order);
    }

    function buyCroissant() {
      let order = {
        name: "croissant",
        price: "2.00",
      };
      sendOrder(order);
    }

    function buySandwich() {
      let order = {
        name: "sandwich",
        price: "6.50",
      };
      sendOrder(order);
    }

    function buyCheeseCake() {
      let order = {
        name: "cheesecake",
        price: "5.00",
      };
      sendOrder(order);
    }

    function sendOrder(order) {
      fetch("http://localhost:8080/order-service", {
        method: "POST",
        headers: {
          "Content-type": "application/json",
        },
        body: JSON.stringify(order),
      })
        .then((response) => response.json())
        .then((data) => {
          alert(data);
        })
        .catch((error) => {
          console.error(error);
        });
    }
    
    //Graceful stop of Disitributed Tracing
    process.on("SIGTERM", () => {
      sdk.shutdown()
        .then(() => console.log("Tracing terminated"))
        .catch((error) => console.log("Error terminating tracing", error))
        .finally(() => process.exit(0));
    });
  </script>
</body>
